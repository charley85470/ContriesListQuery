<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Contries Query</title>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <table id="resultTable" class="table table-bordered">
      <thead>
        <th>國旗</th>
        <th>國家名稱</th>
        <th>2位國家代碼</th>
        <th>3位國家代碼</th>
        <th>母語名稱</th>
        <th>替代國家名稱</th>
        <th>國際電話區號</th>
      </thead>
      <tbody></tbody>
    </table>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />

    <script>
      var contries = [];
      $(function () {
        GetCountryData();
      });

      // 取得國家資料
      function GetCountryData() {
        SendAjax({
          type: 'GET',
          url: 'https://restcountries.eu/rest/v2/all',
          onSuccess: function (result) {
            contries = JSON.parse(result);
            GenerateTableRow();
          },
          onError() {},
        });
      }

      // 建立Ajax連線
      function SendAjax({
        type: type, // HTTP Type
        url: url, // Connect URL
        onSuccess: onSuccess, // Function when Call API Success
        onError: onError, // Function when Call API Error
      }) {
        var oReq = new XMLHttpRequest();

        // Event On Load Success
        oReq.addEventListener('load', function () {
          onSuccess(this.response);
        });

        // Event On Load Error
        oReq.addEventListener('error', function () {
          onError(this.response);
        });

        oReq.open(type, url); // Open Connection
        oReq.send(); // Send Request
      }

      // 綁定資料至Table內
      function GenerateTableRow() {
        let tb = document.querySelector('#resultTable tbody');
        tb.innerHTML = ''; // 清空內容
        let t = document.querySelector('#countryrow'); // Template Table row
        let td = t.content.querySelectorAll('td'); // table td items
        contries.forEach((element) => {
          td[0].querySelector('img').src = element.flag;
          td[1].textContent = element.name;
          td[2].textContent = element.alpha2Code;
          td[3].textContent = element.alpha3Code;
          td[4].textContent = element.nativeName;
          td[5].textContent = element.altSpellings;
          td[6].textContent = element.callingCodes;

          tb.appendChild(document.importNode(t.content, true)); // DeepClone 並Appent到Tbody中
        });
      }
    </script>

    <template id="countryrow">
      <tr>
        <td>
          <img style="max-height: 2rem" src="" alt="" />
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </template>
  </body>
</html>
